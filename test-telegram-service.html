<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Telegram Service</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h1>Test Telegram Service</h1>

        <div class="card mt-4">
            <div class="card-body">
                <h5>Telegram Configuration</h5>
                <p><strong>Bot Token:</strong> <span id="botToken"></span></p>
                <p><strong>Chat ID:</strong> <span id="chatId"></span></p>
            </div>
        </div>

        <div class="card mt-4">
            <div class="card-body">
                <h5>Test Send Messages</h5>

                <div class="mb-3">
                    <button id="btnStatus" class="btn btn-primary">Send Status: ONLINE</button>
                    <button id="btnOffline" class="btn btn-danger">Send Status: OFFLINE</button>
                </div>

                <div class="mb-3">
                    <button id="btnSignal" class="btn btn-success">Send Test Signal</button>
                </div>

                <div class="alert alert-info">
                    <strong>Console:</strong> Buka console untuk melihat hasil
                </div>
            </div>
        </div>

        <div class="card mt-4">
            <div class="card-body">
                <h5>Log</h5>
                <pre id="log" class="bg-dark text-light p-3" style="max-height: 400px; overflow-y: auto;"></pre>
            </div>
        </div>
    </div>

    <!-- Load dependencies -->
    <script src="assets/js/config_app.js"></script>
    <script src="assets/js/mixins/Http.js"></script>
    <script src="assets/js/services/telegram-service.js"></script>

    <script>
        // Display config
        document.getElementById('botToken').textContent = KONFIG_APLIKASI.TELEGRAM.BOT_TOKEN.substring(0, 20) + '...';
        document.getElementById('chatId').textContent = KONFIG_APLIKASI.TELEGRAM.CHAT_ID;

        // Initialize Telegram service
        const telegramService = new TelegramService({
            botToken: KONFIG_APLIKASI.TELEGRAM.BOT_TOKEN,
            chatId: KONFIG_APLIKASI.TELEGRAM.CHAT_ID
        });

        // Logger
        function log(message) {
            const logEl = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString('id-ID');
            logEl.textContent += `[${timestamp}] ${message}\n`;
            logEl.scrollTop = logEl.scrollHeight;
            console.log(`[${timestamp}] ${message}`);
        }

        // Test buttons
        document.getElementById('btnStatus').addEventListener('click', async () => {
            log('Sending status: ONLINE...');
            await telegramService.sendStatus('ONLINE');
            log('Status ONLINE sent!');
        });

        document.getElementById('btnOffline').addEventListener('click', async () => {
            log('Sending status: OFFLINE...');
            await telegramService.sendStatus('OFFLINE');
            log('Status OFFLINE sent!');
        });

        document.getElementById('btnSignal').addEventListener('click', async () => {
            log('Sending test signal...');

            const testSignal = `
<b>🚀 SIGNAL PROFITABLE</b>

<b>💰 Token:</b> BTC/USDT
<b>🔗 Chain:</b> BSC
<b>🏦 CEX:</b> BINANCE
<b>💱 DEX:</b> KYBER
<b>🔄 Direction:</b> CEX → DEX

<b>📊 Results:</b>
Modal: $100.00
Result: $102.50
PNL: $2.50 (+2.50%)
PNL IDR: Rp 39,500

<b>💸 Total Cost:</b> $0.45

<b>⏰</b> ${new Date().toLocaleString('id-ID')}
            `.trim();

            await telegramService.sendSignal(testSignal);
            log('Test signal sent!');
        });

        log('Telegram Service initialized and ready');
        log('Click buttons to test sending messages');
    </script>
</body>
</html>
